p8105_hw6_iah2124
================
Iris Hart
2024-12-02

## Problem 1

Loading the weather data

``` r
weather_df = 
  rnoaa::meteo_pull_monitors(
    c("USW00094728"),
    var = c("PRCP", "TMIN", "TMAX"), 
    date_min = "2017-01-01",
    date_max = "2017-12-31") %>%
  mutate(
    name = recode(id, USW00094728 = "CentralPark_NY"),
    tmin = tmin / 10,
    tmax = tmax / 10) %>%
  select(name, id, everything())
```

    ## using cached file: /Users/irishart/Library/Caches/org.R-project.R/R/rnoaa/noaa_ghcnd/USW00094728.dly

    ## date created (size, mb): 2024-10-29 08:13:52.67168 (8.656)

    ## file min/max dates: 1869-01-01 / 2024-10-31

Set up the bootstrapping process

``` r
set.seed(123)  

n_bootstrap <- 5000
```

Creating a function to perform regression and extract required metrics

``` r
bootstrap_results <- replicate(n_bootstrap, {
  sample_data <- weather_df %>% sample_frac(replace = TRUE)
  
  lm_fit <- lm(tmax ~ tmin, data = sample_data)
  
  r_squared <- glance(lm_fit)$r.squared
  
  coef_values <- tidy(lm_fit)
  
  beta_0 <- coef_values$estimate[1]
  beta_1 <- coef_values$estimate[2]
  log_beta_prod <- log(beta_0 * beta_1)
  
  c(r_squared = r_squared, log_beta_prod = log_beta_prod)
}, simplify = TRUE)

bootstrap_df <- as.data.frame(t(bootstrap_results))
colnames(bootstrap_df) <- c("r_squared", "log_beta_prod")
```

Plot the distribution of r_squared

``` r
ggplot(bootstrap_df, aes(x = r_squared)) +
  geom_density(fill = "skyblue", alpha = 0.5) +
  labs(title = "Distribution of Bootstrap Estimates for r^2", x = "r^2", y = "Density")
```

![](p8105_hw6_iah2124_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->
Plot the distribution of log(β0 \* β1)

``` r
ggplot(bootstrap_df, aes(x = log_beta_prod)) +
  geom_density(fill = "lightgreen", alpha = 0.5) +
  labs(title = "Distribution of Bootstrap Estimates for log(β0 * β1)", x = "log(β0 * β1)", y = "Density")
```

![](p8105_hw6_iah2124_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->
Calculate 95% Confidence Intervals

``` r
ci_r_squared <- quantile(bootstrap_df$r_squared, c(0.025, 0.975))
ci_log_beta_prod <- quantile(bootstrap_df$log_beta_prod, c(0.025, 0.975))

cat("95% Confidence Interval for r^2: [", ci_r_squared[1], ", ", ci_r_squared[2], "]\n")
```

    ## 95% Confidence Interval for r^2: [ 0.8945701 ,  0.9271042 ]

``` r
cat("95% Confidence Interval for log(β0 * β1): [", ci_log_beta_prod[1], ", ", ci_log_beta_prod[2], "]\n")
```

    ## 95% Confidence Interval for log(β0 * β1): [ 1.964166 ,  2.058364 ]

## Problem 2

Load data and filter out city states and races unneeded

``` r
homicide_df <- read_csv("homicide-data.csv") |>

  mutate(city_state = paste(city, state, sep = ",")) |>  

  filter(!(city_state %in% c("Dallas,TX", "Phoenix,AZ", "Kansas City,MO", "Tulsa,AL"))) |> 

  mutate(
    solved = case_when(
      disposition == "Closed without arrest" ~ 0,
      disposition == "Open/No arrest" ~ 0, 
      disposition == "Closed by arrest" ~ 1,
      TRUE ~ NA_real_  
    )
  ) |> 

  filter(victim_race %in% c("White", "Black")) |>  

  mutate(
    victim_age = as.numeric(victim_age)  
  )
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

    ## Warning: There was 1 warning in `mutate()`.
    ## ℹ In argument: `victim_age = as.numeric(victim_age)`.
    ## Caused by warning:
    ## ! NAs introduced by coercion

``` r
view(homicide_df)
```

Calculating the estimate and confidence interval of the adjusted odds
ratio for solving homicides comparing male victims to female victims
keeping all other variables fixed.

``` r
baltimore_df <- homicide_df |>
  filter(city_state == "Baltimore,MD")

baltimore_reg <- glm(
  solved ~ victim_age + victim_sex + victim_race, 
  data = baltimore_df, 
  family = binomial()  
)

baltimore_OR <- broom::tidy(baltimore_reg) |>
  mutate(
    OR = exp(estimate), 
    CI_upper = exp(estimate + 1.96 * std.error),  # Upper bound of CI
    CI_lower = exp(estimate - 1.96 * std.error)   # Lower bound of CI
  ) |>
  filter(term == "victim_sexMale") |>
  select(OR, CI_lower, CI_upper)  

baltimore_OR
```

    ## # A tibble: 1 × 3
    ##      OR CI_lower CI_upper
    ##   <dbl>    <dbl>    <dbl>
    ## 1 0.426    0.325    0.558

Calculating ORs for each city listed

``` r
allcity_ORresults <- homicide_df |>
  nest(data = -city_state) |>
  mutate(
    model = map(data, ~ glm(solved ~ victim_age + victim_sex + victim_race, data = .x, family = binomial())), 
    tidy_model = map(model, broom::tidy)
  ) |>
  select(-model, -data) |>
  unnest(cols = tidy_model) |>
  mutate(
    OR = exp(estimate), 
    CI_upper = exp(estimate + 1.96 * std.error),  
    CI_lower = exp(estimate - 1.96 * std.error)   
  ) |>
  filter(term == "victim_sexMale") |>
  select(city_state, OR, CI_upper, CI_lower)

allcity_ORresults |>
  knitr::kable(digits = 4)
```

| city_state        |     OR | CI_upper | CI_lower |
|:------------------|-------:|---------:|---------:|
| Albuquerque,NM    | 1.7675 |   3.7609 |   0.8307 |
| Atlanta,GA        | 1.0001 |   1.4631 |   0.6836 |
| Baltimore,MD      | 0.4255 |   0.5579 |   0.3246 |
| Baton Rouge,LA    | 0.3814 |   0.6953 |   0.2093 |
| Birmingham,AL     | 0.8700 |   1.3180 |   0.5743 |
| Boston,MA         | 0.6740 |   1.2760 |   0.3560 |
| Buffalo,NY        | 0.5206 |   0.9352 |   0.2898 |
| Charlotte,NC      | 0.8839 |   1.4027 |   0.5570 |
| Chicago,IL        | 0.4101 |   0.5006 |   0.3360 |
| Cincinnati,OH     | 0.3998 |   0.6771 |   0.2361 |
| Columbus,OH       | 0.5325 |   0.7496 |   0.3783 |
| Denver,CO         | 0.4791 |   0.9707 |   0.2364 |
| Detroit,MI        | 0.5823 |   0.7337 |   0.4622 |
| Durham,NC         | 0.8124 |   1.6833 |   0.3920 |
| Fort Worth,TX     | 0.6690 |   1.1275 |   0.3969 |
| Fresno,CA         | 1.3352 |   3.0709 |   0.5805 |
| Houston,TX        | 0.7110 |   0.9066 |   0.5577 |
| Indianapolis,IN   | 0.9187 |   1.2423 |   0.6794 |
| Jacksonville,FL   | 0.7198 |   0.9657 |   0.5365 |
| Las Vegas,NV      | 0.8373 |   1.1537 |   0.6077 |
| Long Beach,CA     | 0.4102 |   1.0821 |   0.1555 |
| Los Angeles,CA    | 0.6619 |   0.9563 |   0.4581 |
| Louisville,KY     | 0.4906 |   0.7897 |   0.3047 |
| Memphis,TN        | 0.7232 |   0.9884 |   0.5292 |
| Miami,FL          | 0.5152 |   0.8719 |   0.3045 |
| Milwaukee,wI      | 0.7271 |   1.0602 |   0.4987 |
| Minneapolis,MN    | 0.9470 |   1.8749 |   0.4783 |
| Nashville,TN      | 1.0342 |   1.5622 |   0.6847 |
| New Orleans,LA    | 0.5849 |   0.8112 |   0.4218 |
| New York,NY       | 0.2624 |   0.4991 |   0.1379 |
| Oakland,CA        | 0.5631 |   0.8684 |   0.3651 |
| Oklahoma City,OK  | 0.9741 |   1.5203 |   0.6241 |
| Omaha,NE          | 0.3825 |   0.7208 |   0.2030 |
| Philadelphia,PA   | 0.4963 |   0.6522 |   0.3776 |
| Pittsburgh,PA     | 0.4308 |   0.6999 |   0.2651 |
| Richmond,VA       | 1.0061 |   2.0326 |   0.4980 |
| San Antonio,TX    | 0.7046 |   1.2485 |   0.3977 |
| Sacramento,CA     | 0.6688 |   1.3365 |   0.3347 |
| Savannah,GA       | 0.8670 |   1.7801 |   0.4223 |
| San Bernardino,CA | 0.5003 |   1.4622 |   0.1712 |
| San Diego,CA      | 0.4130 |   0.8550 |   0.1995 |
| San Francisco,CA  | 0.6075 |   1.1651 |   0.3168 |
| St. Louis,MO      | 0.7032 |   0.9323 |   0.5304 |
| Stockton,CA       | 1.3517 |   2.9416 |   0.6211 |
| Tampa,FL          | 0.8077 |   1.8760 |   0.3478 |
| Tulsa,OK          | 0.9758 |   1.5517 |   0.6136 |
| Washington,DC     | 0.6902 |   1.0170 |   0.4684 |

Creating a plot to display OR data

``` r
ggplot(allcity_ORresults, aes(x = reorder(city_state, OR), y = OR, ymin = CI_lower, ymax = CI_upper)) +
  geom_pointrange() +
  labs(
    title = "Estimated Odds Ratios for Solving Homicides: Male vs Female Victims",
    x = "City, State",
    y = "Odds Ratio (OR)",
    caption = "Whiskers represent 95% confidence intervals"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 8),  
    axis.title = element_text(size = 10),  
    axis.text.x = element_text(size = 7, angle = 45, hjust = 1)  
  )
```

![](p8105_hw6_iah2124_files/figure-gfm/unnamed-chunk-11-1.png)<!-- -->

## Problem 3

Loading and cleaning birthweight data

``` r
birthweight_df = read_csv("birthweight.csv") |> 
  mutate(babysex = as.factor(babysex),
         frace = as.factor(frace),
         malform = as.factor(malform),
         mrace = as.factor(mrace)
         )
```

    ## Rows: 4342 Columns: 20
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (20): babysex, bhead, blength, bwt, delwt, fincome, frace, gaweeks, malf...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
view(birthweight_df)
```
